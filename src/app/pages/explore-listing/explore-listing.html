<div class="page-wrapper">

  <section class="search-hero">
    <div class="hero-container">
      <h1>Find your perfect home</h1>
      
      <div class="search-bar">
        <div class="search-input">
          <mat-icon>search</mat-icon>
          <input type="text" [formControl]="searchControl" [matAutocomplete]="auto" placeholder="City, neighborhood, or address">
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCity" (optionSelected)="onCitySelected($event)">
            <mat-option *ngFor="let city of filteredCities" [value]="city">
               {{ city.name }}, {{ city.stateCode }}
            </mat-option>
          </mat-autocomplete>
        </div>
        <button class="btn-primary search-btn" (click)="applyFilters()">Search</button>
      </div>

    </div>
  </section>

  <main class="main-content">
    <div class="container layout-grid">
      
      <aside class="filters-sidebar">
        <div class="filters-header">
          <h3>Filters</h3>
          <button class="reset-btn" (click)="resetFilters()">Reset all</button>
        </div>

        <div class="filter-group">
          <label>Availability</label>
          <div class="checkbox-list">
            
            <label class="custom-checkbox">
              <input type="radio" name="avail" [(ngModel)]="availabilityFilter" value="available" (change)="applyFilters()">
              <span class="checkmark"></span> Available Only
            </label>

            <label class="custom-checkbox">
              <input type="radio" name="avail" [(ngModel)]="availabilityFilter" value="all" (change)="applyFilters()">
              <span class="checkmark"></span> Show All
            </label>

          </div>
        </div>

        <div class="filter-group">
          <label>Max Price: {{ filters.maxPrice | currency:'INR' }}</label>
          <input type="range" class="range-slider" min="500" max="50000" step="500" [(ngModel)]="filters.maxPrice" (change)="applyFilters()">
        </div>

        <div class="filter-group">
          <label>Property Type</label>
          <div class="checkbox-list">
             <label class="custom-checkbox">
              <input type="radio" name="type" [(ngModel)]="filters.propertyType" value="Any" (change)="applyFilters()">
              <span class="checkmark"></span> Any
            </label>
            <label class="custom-checkbox">
              <input type="radio" name="type" [(ngModel)]="filters.propertyType" value="Apartment" (change)="applyFilters()">
              <span class="checkmark"></span> Apartment
            </label>
            <label class="custom-checkbox">
              <input type="radio" name="type" [(ngModel)]="filters.propertyType" value="House" (change)="applyFilters()">
              <span class="checkmark"></span> House
            </label>
            <label class="custom-checkbox">
              <input type="radio" name="type" [(ngModel)]="filters.propertyType" value="Studio" (change)="applyFilters()">
              <span class="checkmark"></span> Studio
            </label>
          </div>
        </div>

        <div class="filter-group">
          <label>Bedrooms</label>
          <div class="pill-group">
            <button class="pill" [class.active]="filters.bedrooms === 'Any'" (click)="filters.bedrooms = 'Any'; applyFilters()">Any</button>
            <button class="pill" [class.active]="filters.bedrooms === '1'" (click)="filters.bedrooms = '1'; applyFilters()">1+</button>
            <button class="pill" [class.active]="filters.bedrooms === '2'" (click)="filters.bedrooms = '2'; applyFilters()">2+</button>
            <button class="pill" [class.active]="filters.bedrooms === '3'" (click)="filters.bedrooms = '3'; applyFilters()">3+</button>
          </div>
        </div>
      </aside>

      <section class="listings-area">
        
        <div class="results-header">
          <span>Showing <strong>{{ totalItems }}</strong> properties</span>
        </div>

        <div *ngIf="isLoading" style="padding: 40px; text-align: center; color: #666;">
           Loading properties...
        </div>

        <div *ngIf="!isLoading && listings.length === 0" style="padding: 40px; text-align: center;">
           <h3>No properties found</h3>
           <p>Try adjusting your filters or search query.</p>
        </div>

        <div class="property-grid" *ngIf="!isLoading && listings.length > 0">
          <div class="property-card" *ngFor="let prop of listings">
            <div class="card-image">
              <img [src]="(prop.photos && prop.photos.length > 0) ? prop.photos[0].photoUrl : 'assets/placeholder.jpg'" alt="Home">
              
              <div class="badges-container">
                 <span class="badge featured" *ngIf="prop.isRented === false">Available</span>
                 <span class="badge" style="background-color: #666; color: white;" *ngIf="prop.isRented === true">Rented</span>
              </div>
            </div>

            <div class="card-details">
              <div class="price-row">
                <div class="price">{{ formatPrice(prop.rentAmount) }}<span class="unit">/mo</span></div>
              </div>
              <h3 class="prop-title">{{ prop.propertyType }} in {{ prop.city }}</h3>
              <p class="prop-address"><mat-icon>location_on</mat-icon> {{ prop.street }}, {{ prop.city }}</p>

              <div class="prop-specs">
                <span><mat-icon>bed</mat-icon> {{ prop.bedrooms }} Beds</span>
                <span><mat-icon>bathtub</mat-icon> {{ prop.bathrooms }} Baths</span>
                <span><mat-icon>square_foot</mat-icon> {{ prop.propertySize }} sqft</span>
              </div>

              <button class="btn-outline full-width" (click)="viewDetails(prop.id)">View Details</button>
            </div>
          </div>
        </div>

        <div class="pagination" *ngIf="totalPages > 1">
          <button class="page-btn" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 0">
            <mat-icon>chevron_left</mat-icon>
          </button>
          <button class="page-btn" *ngFor="let p of pagesArray" [class.active]="p === currentPage" (click)="changePage(p)">
            {{ p + 1 }}
          </button>
          <button class="page-btn" (click)="changePage(currentPage + 1)" [disabled]="currentPage >= totalPages - 1">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>

      </section>
    </div>
  </main>
</div>