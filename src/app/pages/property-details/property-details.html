<div class="loading-state" *ngIf="isLoading">
  <mat-icon class="spinner">sync</mat-icon> Loading details...
</div>

<div class="page-container" *ngIf="!isLoading && property">
  
  <header class="property-header">
    <div class="header-content">
      <div class="title-section">
        <div class="breadcrumbs">
          <a routerLink="/explore">Explore</a> &gt; {{ property.details.address.city }}
        </div>
        <h1>{{ property.final.title }}</h1>
        <p class="address">
          <mat-icon>location_on</mat-icon> 
          {{ property.details.address.street }}, {{ property.details.address.city }}, {{ property.details.address.state }}
        </p>
      </div>
      <div class="action-buttons">
        <button class="btn-outline"><mat-icon>ios_share</mat-icon> Share</button>
        <button class="btn-outline"><mat-icon>favorite_border</mat-icon> Save</button>
      </div>
    </div>
  </header>

  <section class="gallery-section">
    <div class="gallery-grid">
      <div class="main-img">
        <img [src]="property.final.images[0] || 'assets/placeholder.jpg'" alt="Main">
      </div>
      <div class="side-img"><img [src]="property.final.images[1] || property.final.images[0]" alt="Interior"></div>
      <div class="side-img"><img [src]="property.final.images[2] || property.final.images[0]" alt="Kitchen"></div>
      <div class="side-img"><img [src]="property.final.images[3] || property.final.images[0]" alt="Bedroom"></div>
      <div class="side-img relative">
        <img [src]="property.final.images[0]" alt="More">
        <button class="view-photos-btn">
          <mat-icon>grid_view</mat-icon> Show all photos
        </button>
      </div>
    </div>
  </section>

  <section class="specs-bar">
    <div class="spec-item"><mat-icon>bed</mat-icon> <strong>{{ property.details.bedrooms }}</strong> Beds</div>
    <div class="spec-item"><mat-icon>bathtub</mat-icon> <strong>{{ property.details.bathrooms }}</strong> Baths</div>
    <div class="spec-item"><mat-icon>square_foot</mat-icon> <strong>{{ property.details.propertySize }}</strong> Sq Ft</div>
    <div class="spec-item"><mat-icon>pets</mat-icon> <strong>Allowed</strong></div>
  </section>

  <div class="content-layout">
    
    <div class="details-column">
      
      <section class="info-block">
        <h2>About this home</h2>
        <p [class.truncated]="!showFullDescription">
          {{ property.final.description }}
        </p>
        <button class="link-btn" (click)="showFullDescription = !showFullDescription">
          {{ showFullDescription ? 'Show less' : 'Show more' }} <mat-icon>expand_more</mat-icon>
        </button>
      </section>

      <div class="divider"></div>

      <section class="info-block">
        <h2>What this place offers</h2>
        <div class="amenities-grid">
          <div class="amenity-item" *ngFor="let am of displayAmenities">
            <mat-icon>{{ am.icon }}</mat-icon> {{ am.label }}
          </div>
        </div>
      </section>

      <div class="divider"></div>

      <section class="info-block">
        <h2>Where you'll be</h2>
        <p style="margin-bottom: 12px;">{{ property.details.address.city }}, {{ property.details.address.state }}</p>
        <div class="map-placeholder">
          <mat-icon>home</mat-icon> Map View
        </div>
      </section>
    </div>

    <div class="sidebar-column">
      <div class="booking-card">
        <div class="card-header">
           <div class="price">${{ property.final.rentAmount | number }}<span>/mo</span></div>
           <div class="rating"><mat-icon>star</mat-icon> 4.9 (12)</div>
        </div>
        <div class="status-tag">Available Now</div>

        <button class="btn-primary full-width">Request to Book</button>
        <button class="btn-outline full-width">Schedule a Tour</button>
      </div>

      <div class="agent-card">
        <div class="agent-info">
          <div class="avatar">AG</div>
          <div>
            <h4>Agent Name</h4>
            <p>Premier Agent</p>
          </div>
        </div>
        <button class="btn-text">Contact Agent</button>
      </div>
    </div>
  </div>

  <section class="similar-section" *ngIf="similarProperties.length > 0">
    <h2>Similar homes you might like</h2>
    <div class="similar-grid">
      <a [routerLink]="['/property', home.id]" class="similar-card" *ngFor="let home of similarProperties">
        <img [src]="home.final.images[0] || 'assets/placeholder.jpg'" alt="Home">
        <div class="sim-details">
          <div class="sim-price">${{ home.final.rentAmount | number }}<span>/mo</span></div>
          <h4>{{ home.final.title }}</h4>
          <p>{{ home.details.bedrooms }} Beds â€¢ {{ home.details.bathrooms }} Baths</p>
        </div>
      </a>
    </div>
  </section>

</div>

<div class="not-found-state" *ngIf="!isLoading && !property">
  <mat-icon style="font-size: 64px; height: 64px; width: 64px; color: #ccc;">search_off</mat-icon>
  <h2>Property not found</h2>
  <button mat-flat-button color="primary" routerLink="/explore">Back to Explore</button>
</div>